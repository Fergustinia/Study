# Установка семени для воспроизводимости результатов
set.seed(666)

# 1. Генерация выборки X1 из нормального распределения
N <- 200           # Объем выборки
a1 <- 0            # Среднее для X1(мат ожидание)
S1 <- 1            # Стандартное отклонение для X1(дисперсия)
X1 <- rnorm(N, mean = a1, sd = S1)

# 2. Задание коэффициентов корреляции
r1 <- 0.15         # r1 ∈ [0.1; 0.2]
r2 <- 0.8          # r2 ∈ [0.6; 0.9]

# 3. Генерация выборок X2 и X3 с заданной корреляцией
a2 <- 0            # Среднее для случайных компонент X2 и X3
S2 <- 1            # Стандартное отклонение для случайных компонент
X2 <- r1 * X1 + sqrt(1 - r1^2) * rnorm(N, mean = a2, sd = S2)
X3 <- r2 * X1 + sqrt(1 - r2^2) * rnorm(N, mean = a2, sd = S2)

# 4. Построение диаграмм рассеяния
par(mfrow = c(1, 2))  # Разделение окна на 2 графика
plot(X1, X2, main = "Диаграмма рассеяния X1 и X2", xlab = "X1", ylab = "X2", pch = 16, col = "blue")
plot(X1, X3, main = "Диаграмма рассеяния X1 и X3", xlab = "X1", ylab = "X3", pch = 16, col = "red")

# 5. Расчет выборочных коэффициентов корреляции
r_hat1 <- cor(X1, X2)
r_hat2 <- cor(X1, X3)
cat("Выборочный коэффициент корреляции X1 и X2: ", r_hat1, "\n")
cat("Выборочный коэффициент корреляции X1 и X3: ", r_hat2, "\n")

# 6. Проверка гипотезы о наличии корреляционной связи с помощью t-статистики
t_test1 <- cor.test(X1, X2)
t_test2 <- cor.test(X1, X3)
cat("\nРезультаты теста для X1 и X2:\n")
print(t_test1)
cat("\nРезультаты теста для X1 и X3:\n")
print(t_test2)

# 7. Функция для расчета доверительного интервала с Z-преобразованием Фишера, приближенно нормальное распределения 
fisher_ci <- function(r, N, conf_level = 0.95) {
  z <- 0.5 * log((1 + r) / (1 - r))              # Z-преобразование
  se <- 1 / sqrt(N - 3)                          # Стандартная ошибка
  z_crit <- qnorm(1 - (1 - conf_level) / 2)     # Критическое значение для 95% уровня
  z_lower <- z - z_crit * se                    # Нижняя граница Z
  z_upper <- z + z_crit * se                    # Верхняя граница Z
  r_lower <- (exp(2 * z_lower) - 1) / (exp(2 * z_lower) + 1)  # Обратное преобразование
  r_upper <- (exp(2 * z_upper) - 1) / (exp(2 * z_upper) + 1)  # Обратное преобразование
  return(c(r_lower, r_upper))
}

# Расчет доверительных интервалов
ci1 <- fisher_ci(r_hat1, N)
ci2 <- fisher_ci(r_hat2, N)
cat("\nДоверительный интервал для r1 (X1 и X2): [", ci1[1], ", ", ci1[2], "]\n") #выборочный коэффицент корреляции
cat("Доверительный интервал для r2 (X1 и X3): [", ci2[1], ", ", ci2[2], "]\n")

